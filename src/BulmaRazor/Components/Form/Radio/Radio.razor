@namespace BulmaRazor.Components

@inherits BulmaComponentBase
@typeparam TValue

<label @attributes="Attributes" disabled="@Disabled" class="@classes">
    <input disabled="@Disabled" name="@name" type="radio" value="@Value" checked="@_checked" @onchange="ChangeHandle" />
    @ChildContent
</label>
@code {
    string classes => CssBuilder.Default("radio")
        .AddClassFromAttributes(Attributes)
        .Build();

    private bool _checked;

    private async Task ChangeHandle(ChangeEventArgs e)
    {
        await Parent.UnCheckAll(Value);
        _checked = true;
    }

    public void SetChecked(bool ck)
    {
        _checked = ck;
    }

    [Parameter]
    public TValue Value { get; set; }


    [Parameter]
    public bool Disabled { get; set; }


    [CascadingParameter]
    public Radios<TValue> Parent { get; set; }

    public int Index { get; set; }


    private string name;

    public async override Task SetParametersAsync(ParameterView parameters)
    {
        await base.SetParametersAsync(parameters);
    }

    protected override void OnInitialized()
    {
        if (Parent == null) throw new ArgumentException("Radio must in Radios Component");

        base.OnInitialized();
        Parent.AddItem(this);
        name = Parent.Name;

        if (Parent.Value != null && Parent.Value.Equals(Value))
        {
            _checked = true;
        }
    }

    [Parameter]
    public RenderFragment ChildContent { get; set; }
}