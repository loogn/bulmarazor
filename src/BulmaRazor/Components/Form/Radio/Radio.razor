
@namespace BulmaRazor.Components

@inherits BulmaComponentBase
@typeparam TValue

<label @attributes="AdditionalAttributes" class="@classes">
    <input checked="@Checked" disabled="@Disabled" name="@Name" type="radio" @bind="@CurrentValue" />
    @ChildContent
</label>
@code {


    string classes => CssBuilder.Default("radio")
        .AddClassFromAttributes(AdditionalAttributes)
        .Build();

    [Parameter]
    public TValue Value { get; set; }

    [Parameter]
    public string Name { get; set; }

    [Parameter]
    public bool Checked { get; set; }

    [Parameter]
    public bool Disabled { get; set; }


    //[Parameter]
    //public EventCallback<TValue> OnValueChanged { get; set; }

    private TValue _value;

    private TValue CurrentValue
    {
        get { return _value; }
        set
        {
            _value = value;
            Parent.SetValue(value).GetAwaiter().GetResult();

            //if (OnValueChanged.HasDelegate)
            //{
            //    OnValueChanged.InvokeAsync(_value).GetAwaiter().GetResult();
            //}
        }
    }

    [CascadingParameter]
    public Radios<TValue> Parent { get; set; }

    protected override void OnInitialized()
    {
        if (Parent == null) throw new ArgumentException("Radio必须是Radios的子组件");

        base.OnInitialized();
        _value = Value;
        if (Parent.Value.Equals(Value))
        {
            Checked = true;
        }
    }

    [Parameter]
    public RenderFragment ChildContent { get; set; }
}
